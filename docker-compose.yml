version: '3.8'

services:
  app:
    build: .
    container_name: impostor_app
    restart: always
    ports:
      - "3000:3000"
    environment:
      - PORT=${PORT:-3000}
      - DATABASE_URL=${DATABASE_URL:-file:./prisma/dev.db}
      - MOCK_MODE=${MOCK_MODE:-false}
      # API Keys
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - MERCADOPAGO_ACCESS_TOKEN=${MERCADOPAGO_ACCESS_TOKEN}
      - NGROK_URL=http://72.61.47.40:3000
      # WhatsApp Integration (WAHA)
      - WAHA_API_URL=${WAHA_API_URL:-http://waha:3000}
      - WAHA_API_KEY=${WAHA_API_KEY:-changeme}
    volumes:
      # Persist SQLite DB
      - ./prisma:/app/prisma
    depends_on:
      - waha

  waha:
    image: devlikeapro/waha:latest
    container_name: waha
    restart: always
    ports:
      - "3002:3000"
    environment:
      - WAHA_API_KEY=${WAHA_API_KEY:-changeme}
      - WAHA_WEBHOOK_URL=http://impostor_app:3000/api/webhook
    volumes:
      - waha_data:/app/.waha

volumes:
  waha_data:
